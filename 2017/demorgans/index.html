<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Evan Hackett - Using De Morgan's Laws for Simpler Regex</title>
  <link rel="shortcut icon" href="/assets/images/favicon.ico">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="alternate" type="application/rss+xml" title="My Blog" href="/feed.xml">
  <link rel="stylesheet" href="/assets/css/highlight.css">

  <!-- mathjax -->
  <script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<!-- fontawesome -->
<script src="https://use.fontawesome.com/f92380e0dd.js"></script>
</head>
<body>

  <nav class="main-nav">
    
        <a href="/"> <span class="arrow">←</span> Home </a>
    

    
        
            <a href="/about">About </a>
        
    
    <a class="cta" href="/feed.xml">Subscribe</a>
</nav>


  

  <section id="wrapper" class="">
    <article class="post">
    <header>
        <h1>Using De Morgan's Laws for Simpler Regex</h1>
        <h2 class="headline">January 21, 2017</h2>
    </header>
    <section id="post-body">
        <p>Often times tools from propositional logic can be useful while programming. A good example of this came up when I was writing some password validation code. As is common, I needed to make sure the password was at least 8 characters, contained at least 1 uppercase, 1 lowercase, and 1 number. Pretty standard. Instead of doing it with for-loops and if-statements (or filters and predicates), I needed to do it the regular expressions. This was because the ORM for the data model had a built in validator that accepted regex objects. So all I had to do was construct the proper regex, hand it to the ORM’s validator, and then whenever a corresponding model object tries to save, the ORM would run the validation on it. Good stuff. But I hadn’t worked with regex very much, so I had a little trouble coming up with the regex I needed. De Morgan’s Laws to the rescue!</p>

<p>Often times you write a regex that follows a general pattern: a valid string contains at least 1 of X, AND at least 1 of Y, AND at least 1 of Z. Writing a regex for this pattern can be surprisingly difficult. This is because there is no logical AND operator in a regex. Since there is an OR operator, we can transform this structure into an equivalent one that is easier to code a regex for by applying De Morgan’s laws.</p>

<p>Here are De Morgan’s laws:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">!</span><span class="p">(</span><span class="nx">a</span> <span class="o">&amp;&amp;</span> <span class="nx">b</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="o">!</span><span class="nx">a</span> <span class="o">||</span> <span class="o">!</span><span class="nx">b</span><span class="p">)</span>
<span class="o">!</span><span class="p">(</span><span class="nx">a</span> <span class="o">||</span> <span class="nx">b</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="o">!</span><span class="nx">a</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">b</span><span class="p">)</span></code></pre></figure>

<p>In english: “The negation of a conjunction is the disjunction of the negations; and
the negation of a disjunction is the conjunction of the negations.”</p>

<p>Applying the laws, we can obtain the structure: an invalid string contains no X, OR no Y, OR no Z. Notice how the “valid” switched to an “invalid”. As you can see, we are now matching on invalid strings instead of valid ones.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">invalid</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Matches anything that contains less than 8 chars OR no numbers OR no uppercase OR no lowercase.</span>
  <span class="k">return</span> <span class="sr">/^</span><span class="se">(</span><span class="sr">.</span><span class="se">{0,7}</span><span class="sr">|</span><span class="se">[^</span><span class="sr">0-9</span><span class="se">]</span><span class="sr">*|</span><span class="se">[^</span><span class="sr">A-Z</span><span class="se">]</span><span class="sr">*|</span><span class="se">[^</span><span class="sr">a-z</span><span class="se">]</span><span class="sr">*</span><span class="se">)</span><span class="sr">$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">password</span><span class="p">);</span>
<span class="p">}</span>  

<span class="k">if</span> <span class="p">(</span><span class="nx">invalid</span><span class="p">(</span><span class="s2">"abc123"</span><span class="p">))</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"INVALID!"</span><span class="p">)</span> <span class="c1">// will log since "abc123" doesn't contain an uppercase.</span></code></pre></figure>

<p>I’m not going to go into detail about the regex itself, since this post wasn’t meant to be an introduction to regex. I just wanted to show a cool trick using stuff from propositional logic.</p>

<p>All that being said, I usually prefer to use a sequence of filters, since I generally don’t like working with regex. So I might prefer to write code like this (depending on how complex the regex):</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">valid</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">chars</span> <span class="o">=</span> <span class="nx">password</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>

  <span class="kr">const</span> <span class="nx">lowers</span> <span class="o">=</span> <span class="nx">chars</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">isLower</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">uppers</span> <span class="o">=</span> <span class="nx">chars</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">isUpper</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">numbers</span> <span class="o">=</span> <span class="nx">chars</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">isDigit</span><span class="p">);</span>

  <span class="c1">// will return 0 (false) if any array is empty</span>
  <span class="k">return</span> <span class="nx">lowers</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">uppers</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">numbers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Even though it is more code, I probably can code things like that quicker than if I tried to use regex. That being said, the De Morgan’s law trick is pretty useful!</p>

    </section>
</article>
<footer id="post-meta" class="clearfix">
    <a href="/">
        <img class="avatar" src="/assets/images/avatar.jpg">
        <div>
            <span class="dark">Evan Hackett</span>
            <span>My blog. Mainly programming stuff.</span>
        </div>
    </a>

    <section id="sharing">
        <a href="https://github.com/evanhackett"><img src="/assets/images/GitHub-Mark-32px.png" alt="github-logo" /></a>
<a href="mailto:evanwhackett@gmail.com"><i class="fa fa-envelope fa-2x" aria-hidden="true"></i></a>

    </section>
</footer>

<!-- Disqus comments -->


<!-- Archive post list -->


  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="/assets/js/main.js"></script>
  <script src="/assets/js/highlight.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXXX-X', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
